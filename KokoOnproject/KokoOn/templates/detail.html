{% extends 'base.html' %}
{% block title %}KokoOn Detail{% endblock %}

    {% block contents %}
    <br>
    <div class="container">
        <div class="row">
          <div class="col offset-3">
            <h2>{{object.title}}</h2>
            <p>{{object.comment}}</p>
            <br>
            <p>{{object.posted_at}}に投稿</p>

            {% if request.user == object.user %}
            <form method="POST">
            <a href="{% url 'KokoOn:mood_delete' object.pk %}"
              class="btn btn-primary my-2">消去する</a>
            {% endif %}
            
          </div>
        </div>

        <div class="row mt-5">
          <div class="col offset-3">
            <h3>コメント</h3>
            <hr>

            {% if user.is_authenticated %}
            <div class="comment-form-area mb-4 p-3 border rounded bg-light">
                <form method="post">
                    {% csrf_token %}
                    {{ comment_form.text }} 
                    <div class="d-grid mt-2">
                        <button type="submit" class="btn btn-success">コメントする</button>
                    </div>
                </form>
            </div>
            {% else %}
            <p class="text-center text-muted">
                <a href="{% url 'accounts:login' %}">ログイン</a>するとコメントできます。
            </p>
            {% endif %}
            {% for comment in comments %}
            <div class="comment-item mb-3 p-3 border rounded">
              <p class="mb-1">
                <strong>{{ comment.user.username }}</strong>
                <small class="text-muted">({{comment.posted_at}})</small> 
              </p>

              
              <p>{{ comment.clean_text }}</p>

              {% if comment.has_youtube %}
              <div class="youtube-preview">
                <a href="https://www.youtube.com/watch?v={{ comment.youtube_id }}" 
                   target="_blank" 
                   rel="noopener noreferrer">
                    
                    <img src="https://img.youtube.com/vi/{{ comment.youtube_id }}/0.jpg"
                          alt="YouTube Thumbnail"
                          class="youtube-thumbnail">
                </a>
              </div>
              {% endif %}

              {% if request.user == comment.comment_user %}
              <form method="POST">
              <a href="{% url 'KokoOn:comment_delete' comment.pk %}"
                class="btn btn-primary my-2">消去する</a>
              {% endif %}
              </div>
            {% empty %}
            <p class="text-muted">まだコメントはありません</p>
            {% endfor %}

          </div>
        </div>


        </div>
    {% endblock %}